
GRANT DROP ANY DIRECTORY TO SYSTEM;
GRANT CREATE ANY DIRECTORY TO SYSTEM;
CREATE OR REPLACE PROCEDURE UPDATE_MON(IMAGE IN VARCHAR2, ID_ IN INTEGER,IMAGEPATH IN VARCHAR2) IS
  l_blob BLOB;
  l_bfile BFILE;
  l_dest_offset INTEGER := 1;
  l_src_offset INTEGER := 1;
  l_lobmaxsize CONSTANT INTEGER := DBMS_LOB.LOBMAXSIZE;
BEGIN
  EXECUTE IMMEDIATE 'CREATE DIRECTORY DIRECT AS ''' || IMAGEPATH || '''';  
  UPDATE MON_AN
  SET HINH_ANH = EMPTY_BLOB()
  WHERE ID = ID_
  RETURNING HINH_ANH INTO l_blob;
  
  l_bfile := BFILENAME('DIRECT', IMAGE);
  DBMS_LOB.FILEOPEN(l_bfile, DBMS_LOB.FILE_READONLY);
  DBMS_LOB.LOADBLOBFROMFILE(l_blob, l_bfile, l_lobmaxsize, l_dest_offset, l_src_offset);
  DBMS_LOB.FILECLOSE(l_bfile);
  DBMS_OUTPUT.PUT_LINE('SIZE OF THE IMAGE IS: ' || DBMS_LOB.GETLENGTH(l_blob));
  EXECUTE IMMEDIATE 'DROP DIRECTORY DIRECT';
  COMMIT;
END;	
